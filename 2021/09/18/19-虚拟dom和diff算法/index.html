<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/%E6%9F%A0%E6%AA%AC%E5%B9%B2.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E8%8D%89%E8%8E%93.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E8%8D%89%E8%8E%93.svg">
  <link rel="mask-icon" href="/images/%E6%9F%A0%E6%AA%AC%E5%B9%B2.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yummy-zz.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ğŸŒ¹è™šæ‹ŸDOMvnodeåŸºäºjsï¼Œåˆ©ç”¨åˆ°äº†ä¸€ä¸ªhå‡½æ•°ï¼Œè¿™ä¸ªhå‡½æ•°ä¸€èˆ¬æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selector(åœ¨vueä¸­ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ª HTML æ ‡ç­¾åã€ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ã€æˆ–ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ã€‚)ï¼Œä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¡¨ç¤ºï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯dataå±æ€§ï¼Œä¹Ÿå°±æ˜¯å„ç§æ ‡ç­¾å±æ€§æˆ–äº‹ä»¶ï¼Œä»¥å¯¹è±¡çš„å½¢å¼è¡¨ç¤ºï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­èŠ‚ç‚¹ï¼Œä»¥æ•°ç»„çš„å½¢å¼è¡¨ç¤ºã€‚å¦‚æœæ ‡ç­¾æ²¡æœ‰dataå±æ€§ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç›´æ¥æ˜¯å­èŠ‚ç‚¹ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="19-è™šæ‹Ÿdomå’Œdiffç®—æ³•">
<meta property="og:url" content="https://yummy-zz.github.io/2021/09/18/19-%E8%99%9A%E6%8B%9Fdom%E5%92%8Cdiff%E7%AE%97%E6%B3%95/index.html">
<meta property="og:site_name" content="Yum">
<meta property="og:description" content="ğŸŒ¹è™šæ‹ŸDOMvnodeåŸºäºjsï¼Œåˆ©ç”¨åˆ°äº†ä¸€ä¸ªhå‡½æ•°ï¼Œè¿™ä¸ªhå‡½æ•°ä¸€èˆ¬æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selector(åœ¨vueä¸­ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ª HTML æ ‡ç­¾åã€ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ã€æˆ–ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ã€‚)ï¼Œä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¡¨ç¤ºï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯dataå±æ€§ï¼Œä¹Ÿå°±æ˜¯å„ç§æ ‡ç­¾å±æ€§æˆ–äº‹ä»¶ï¼Œä»¥å¯¹è±¡çš„å½¢å¼è¡¨ç¤ºï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­èŠ‚ç‚¹ï¼Œä»¥æ•°ç»„çš„å½¢å¼è¡¨ç¤ºã€‚å¦‚æœæ ‡ç­¾æ²¡æœ‰dataå±æ€§ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç›´æ¥æ˜¯å­èŠ‚ç‚¹ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1db54647698e4c76b6fc38a02067ad72%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/3eb33b1b28e7461f9aedb857736a142c%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/727b5dd8a3424d22afd9dc5cf0dae05e%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1efbc4e76c234dccb44cef0a75073d98%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/d7698f560bb44107911585580c241a99%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1cda8545d6634bcdbf2d007193922092%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/fdbca1cefdec4ba08637c37a70f26af6%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1ec374b664e94888b00721829738ea7a%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/44fc88e0125f49328afb321108c72bcd%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/f4f0d74d014743a79e11552b0c9351d5%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/ecc93fb2bc544a83b8cc7b7cbcaf1857%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/885269d6d23340f19e9100ec60564173%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="og:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/833e0a795a3e4893a0c03bb78a63bffc%7Etplv-k3u1fbpfcp-watermark.awebp">
<meta property="article:published_time" content="2021-09-18T08:14:23.000Z">
<meta property="article:modified_time" content="2021-10-03T07:55:57.258Z">
<meta property="article:author" content="Eden Yi">
<meta property="article:tag" content="æ¯æ—¥æ€»ç»“">
<meta property="article:tag" content="diffç®—æ³•">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1db54647698e4c76b6fc38a02067ad72%7Etplv-k3u1fbpfcp-watermark.awebp">

<link rel="canonical" href="https://yummy-zz.github.io/2021/09/18/19-%E8%99%9A%E6%8B%9Fdom%E5%92%8Cdiff%E7%AE%97%E6%B3%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>19-è™šæ‹Ÿdomå’Œdiffç®—æ³• | Yum</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <a target="_blank" rel="noopener" href="https://github.com/Yummy-zZ" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Yum</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yummy-zz.github.io/2021/09/18/19-%E8%99%9A%E6%8B%9Fdom%E5%92%8Cdiff%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="Eden Yi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yum">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          19-è™šæ‹Ÿdomå’Œdiffç®—æ³•
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-18 16:14:23" itemprop="dateCreated datePublished" datetime="2021-09-18T16:14:23+08:00">2021-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-10-03 15:55:57" itemprop="dateModified" datetime="2021-10-03T15:55:57+08:00">2021-10-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="ğŸŒ¹è™šæ‹ŸDOM"><a href="#ğŸŒ¹è™šæ‹ŸDOM" class="headerlink" title="ğŸŒ¹è™šæ‹ŸDOM"></a>ğŸŒ¹è™šæ‹ŸDOM</h2><p><code>vnode</code>åŸºäº<code>js</code>ï¼Œåˆ©ç”¨åˆ°äº†ä¸€ä¸ªhå‡½æ•°ï¼Œè¿™ä¸ªhå‡½æ•°ä¸€èˆ¬æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>selector</code>(<strong>åœ¨<code>vue</code>ä¸­ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ª HTML æ ‡ç­¾åã€ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ã€æˆ–ä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ã€‚</strong>)ï¼Œä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¡¨ç¤ºï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<code>data</code>å±æ€§ï¼Œä¹Ÿå°±æ˜¯å„ç§æ ‡ç­¾å±æ€§æˆ–äº‹ä»¶ï¼Œä»¥å¯¹è±¡çš„å½¢å¼è¡¨ç¤ºï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å­èŠ‚ç‚¹ï¼Œä»¥æ•°ç»„çš„å½¢å¼è¡¨ç¤ºã€‚å¦‚æœæ ‡ç­¾æ²¡æœ‰<code>data</code>å±æ€§ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ç›´æ¥æ˜¯å­èŠ‚ç‚¹ã€‚</p>
<span id="more"></span>

<p><code>vnode</code>å¯ä»¥é…åˆdiffç®—æ³•æ›´é«˜æ•ˆçš„æ›´æ–°<code>DOM</code>ï¼Œå› ä¸ºåŸç”Ÿ<code>DOM</code>æ›´æ–°ä¼šå¯¹æ•´ä¸ª<code>DOM</code>æ ‘è¿›è¡Œæ›´æ–°ï¼Œè€Œ<code>vnode+diff</code>ç®—æ³•å¯ä»¥åªå¯¹å±€éƒ¨<code>DOM</code>è¿›è¡Œæ›´æ–°ï¼Œå› ä¸º<code>vnode+diff</code>åªæ˜¯å¯¹<code>DOM</code>å…ƒç´ è¿›è¡Œä¿®æ”¹ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>å“ˆå“ˆ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>å‘µå‘µ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>å˜¿å˜¿<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„è™šæ‹ŸDOM</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dom = &#123;</span><br><span class="line">  <span class="attr">tagName</span>: <span class="string">&#x27;ul&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;list&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;<span class="attr">tagName</span>: <span class="string">&#x27;li&#x27;</span>, <span class="attr">props</span>: &#123;<span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span>&#125;, <span class="attr">children</span>: [<span class="string">&#x27;å“ˆå“ˆ&#x27;</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">tagName</span>: <span class="string">&#x27;li&#x27;</span>, <span class="attr">props</span>: &#123;<span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span>&#125;, <span class="attr">children</span>: [<span class="string">&#x27;å‘µå‘µ&#x27;</span>]&#125;,</span><br><span class="line">    &#123;<span class="attr">tagName</span>: <span class="string">&#x27;li&#x27;</span>, <span class="attr">props</span>: &#123;<span class="attr">class</span>: <span class="string">&#x27;item&#x27;</span>&#125;, <span class="attr">children</span>: [<span class="string">&#x27;å˜¿å˜¿&#x27;</span>]&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h(<span class="string">&quot;div#container.two.classes&quot;</span>, &#123; <span class="attr">on</span>: &#123; <span class="attr">click</span>: someFn &#125; &#125;, [ <span class="comment">// vueä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯selectoré€‰æ‹©å™¨äº†,è€Œæ˜¯tagNameï¼Œclasså’Œidæ”¾åœ¨ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºï¼Œæ­¤å†™æ³•æ˜¯snabbdom </span></span><br><span class="line">  h(<span class="string">&quot;span&quot;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">fontWeight</span>: <span class="string">&quot;bold&quot;</span> &#125; &#125;, <span class="string">&quot;This is bold&quot;</span>),</span><br><span class="line">  <span class="string">&quot; and this is just normal text&quot;</span>,</span><br><span class="line">  h(<span class="string">&quot;a&quot;</span>, &#123; <span class="attr">props</span>: &#123; <span class="attr">href</span>: <span class="string">&quot;/foo&quot;</span> &#125; &#125;, <span class="string">&quot;I&#x27;ll take you places!&quot;</span>),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// vueä¸­çš„æ¸²æŸ“å‡½æ•°</span></span><br><span class="line">app.component(<span class="string">&#x27;anchored-heading&#x27;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h(</span><br><span class="line">      <span class="string">&#x27;h&#x27;</span> + <span class="built_in">this</span>.level, <span class="comment">// æ ‡ç­¾å</span></span><br><span class="line">      &#123;&#125;, <span class="comment">// prop æˆ– attribute</span></span><br><span class="line">      <span class="built_in">this</span>.$slots.default() <span class="comment">// åŒ…å«å…¶å­èŠ‚ç‚¹çš„æ•°ç»„</span></span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">level</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/api/instance-properties.html#slots"><code>this.$slots</code></a> è®¿é—®é™æ€æ’æ§½çš„å†…å®¹ï¼Œæ¯ä¸ªæ’æ§½éƒ½æ˜¯ä¸€ä¸ª VNode æ•°ç»„,ä¾‹å¦‚this.$slots.default()</p>
<h2 id="ğŸŒˆä»€ä¹ˆæ˜¯diffç®—æ³•"><a href="#ğŸŒˆä»€ä¹ˆæ˜¯diffç®—æ³•" class="headerlink" title="ğŸŒˆä»€ä¹ˆæ˜¯diffç®—æ³•"></a>ğŸŒˆä»€ä¹ˆæ˜¯diffç®—æ³•</h2><p><strong>Diffç®—æ³•æ˜¯ä¸€ç§å¯¹æ¯”ç®—æ³•</strong>ã€‚å¯¹æ¯”ä¸¤è€…æ˜¯<code>æ—§è™šæ‹ŸDOMå’Œæ–°è™šæ‹ŸDOM</code>ï¼Œå¯¹æ¯”å‡ºæ˜¯å“ªä¸ª<code>è™šæ‹ŸèŠ‚ç‚¹</code>æ›´æ”¹äº†ï¼Œæ‰¾å‡ºè¿™ä¸ª<code>è™šæ‹ŸèŠ‚ç‚¹</code>ï¼Œå¹¶åªæ›´æ–°è¿™ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ‰€å¯¹åº”çš„<code>çœŸå®èŠ‚ç‚¹</code>ï¼Œè€Œä¸ç”¨æ›´æ–°å…¶ä»–æ•°æ®æ²¡å‘ç”Ÿæ”¹å˜çš„èŠ‚ç‚¹ï¼Œå®ç°<code>ç²¾å‡†</code>åœ°æ›´æ–°çœŸå®DOMï¼Œè¿›è€Œ<code>æé«˜æ•ˆç‡</code>ã€‚</p>
<p><code>ä½¿ç”¨è™šæ‹ŸDOMç®—æ³•çš„æŸè€—è®¡ç®—</code>ï¼š æ€»æŸè€— = è™šæ‹ŸDOMå¢åˆ æ”¹+ï¼ˆä¸Diffç®—æ³•æ•ˆç‡æœ‰å…³ï¼‰çœŸå®DOMå·®å¼‚å¢åˆ æ”¹+ï¼ˆè¾ƒå°‘çš„èŠ‚ç‚¹ï¼‰æ’ç‰ˆä¸é‡ç»˜</p>
<p><code>ç›´æ¥æ“ä½œçœŸå®DOMçš„æŸè€—è®¡ç®—</code>ï¼š æ€»æŸè€— = çœŸå®DOMå®Œå…¨å¢åˆ æ”¹+ï¼ˆå¯èƒ½è¾ƒå¤šçš„èŠ‚ç‚¹ï¼‰æ’ç‰ˆä¸é‡ç»˜</p>
<h2 id="ğŸ“Diffç®—æ³•çš„åŸç†"><a href="#ğŸ“Diffç®—æ³•çš„åŸç†" class="headerlink" title="ğŸ“Diffç®—æ³•çš„åŸç†"></a>ğŸ“Diffç®—æ³•çš„åŸç†</h2><h3 id="â‘ åŒå±‚æ¯”è¾ƒ"><a href="#â‘ åŒå±‚æ¯”è¾ƒ" class="headerlink" title="â‘ åŒå±‚æ¯”è¾ƒ"></a>â‘ åŒå±‚æ¯”è¾ƒ</h3><p>æ–°æ—§è™šæ‹ŸDOMå¯¹æ¯”çš„æ—¶å€™ï¼ŒDiffç®—æ³•æ¯”è¾ƒåªä¼šåœ¨åŒå±‚çº§è¿›è¡Œ, ä¸ä¼šè·¨å±‚çº§æ¯”è¾ƒã€‚ æ‰€ä»¥Diffç®—æ³•æ˜¯:<code>æ·±åº¦ä¼˜å…ˆç®—æ³•</code>ã€‚ æ—¶é—´å¤æ‚åº¦:<code>O(n)</code></p>
<h3 id="â‘¡å¯¹æ¯”æµç¨‹"><a href="#â‘¡å¯¹æ¯”æµç¨‹" class="headerlink" title="â‘¡å¯¹æ¯”æµç¨‹"></a>â‘¡å¯¹æ¯”æµç¨‹</h3><p>å½“æ•°æ®æ”¹å˜æ—¶ï¼Œä¼šè§¦å‘<code>setter</code>ï¼Œå¹¶ä¸”é€šè¿‡<code>Dep.notify</code>å»é€šçŸ¥æ‰€æœ‰<code>è®¢é˜…è€…Watcher</code>ï¼Œè®¢é˜…è€…ä»¬å°±ä¼šè°ƒç”¨<code>patchæ–¹æ³•</code>ï¼Œç»™çœŸå®DOMæ‰“è¡¥ä¸ï¼Œæ›´æ–°ç›¸åº”çš„è§†å›¾ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1db54647698e4c76b6fc38a02067ad72%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸Šåˆ11.49.38.png"></p>
<h3 id="patchæ–¹æ³•"><a href="#patchæ–¹æ³•" class="headerlink" title="patchæ–¹æ³•"></a>patchæ–¹æ³•</h3><p>è¿™ä¸ªæ–¹æ³•ä½œç”¨å°±æ˜¯ï¼Œå¯¹æ¯”å½“å‰åŒå±‚çš„è™šæ‹ŸèŠ‚ç‚¹æ˜¯å¦ä¸ºåŒä¸€ç§ç±»å‹çš„æ ‡ç­¾<code>(åŒä¸€ç±»å‹çš„æ ‡å‡†ï¼Œä¸‹é¢ä¼šè®²)</code>ï¼š</p>
<ul>
<li>æ˜¯ï¼šç»§ç»­æ‰§è¡Œ<code>patchVnodeæ–¹æ³•</code>è¿›è¡Œæ·±å±‚æ¯”å¯¹</li>
<li>å¦ï¼šæ²¡å¿…è¦æ¯”å¯¹äº†ï¼Œç›´æ¥æ•´ä¸ªèŠ‚ç‚¹æ›¿æ¢æˆ<code>æ–°è™šæ‹ŸèŠ‚ç‚¹</code></li>
</ul>
<p>æ¥çœ‹çœ‹<code>patch</code>çš„æ ¸å¿ƒåŸç†ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span>(<span class="params">oldVnode, newVnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ¯”è¾ƒæ˜¯å¦ä¸ºä¸€ä¸ªç±»å‹çš„èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (sameVnode(oldVnode, newVnode)) &#123;</span><br><span class="line">    <span class="comment">// æ˜¯ï¼šç»§ç»­è¿›è¡Œæ·±å±‚æ¯”è¾ƒ</span></span><br><span class="line">    patchVnode(oldVnode, newVnode)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦</span></span><br><span class="line">    <span class="keyword">const</span> oldEl = oldVnode.el <span class="comment">// æ—§è™šæ‹ŸèŠ‚ç‚¹çš„çœŸå®DOMèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> parentEle = api.parentNode(oldEl) <span class="comment">// è·å–çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    createEle(newVnode) <span class="comment">// åˆ›å»ºæ–°è™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„çœŸå®DOMèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (parentEle !== <span class="literal">null</span>) &#123;</span><br><span class="line">      api.insertBefore(parentEle, vnode.el, api.nextSibling(oEl)) <span class="comment">// å°†æ–°å…ƒç´ æ·»åŠ è¿›çˆ¶å…ƒç´ </span></span><br><span class="line">      api.removeChild(parentEle, oldVnode.el)  <span class="comment">// ç§»é™¤ä»¥å‰çš„æ—§å…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line">      <span class="comment">// è®¾ç½®nullï¼Œé‡Šæ”¾å†…å­˜</span></span><br><span class="line">      oldVnode = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newVnode</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<h3 id="sameVnodeæ–¹æ³•"><a href="#sameVnodeæ–¹æ³•" class="headerlink" title="sameVnodeæ–¹æ³•"></a>sameVnodeæ–¹æ³•</h3><p>patchå…³é”®çš„ä¸€æ­¥å°±æ˜¯<code>sameVnodeæ–¹æ³•åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ç±»å‹èŠ‚ç‚¹</code>ï¼Œé‚£é—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆæ‰ç®—æ˜¯åŒä¸€ç±»å‹èŠ‚ç‚¹å‘¢ï¼Ÿè¿™ä¸ª<code>ç±»å‹</code>çš„æ ‡å‡†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å’±ä»¬æ¥çœ‹çœ‹sameVnodeæ–¹æ³•çš„æ ¸å¿ƒåŸç†ä»£ç ï¼Œå°±ä¸€ç›®äº†ç„¶äº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sameVnode</span>(<span class="params">oldVnode, newVnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    oldVnode.key === newVnode.key &amp;&amp; <span class="comment">// keyå€¼æ˜¯å¦ä¸€æ ·</span></span><br><span class="line">    oldVnode.tagName === newVnode.tagName &amp;&amp; <span class="comment">// æ ‡ç­¾åæ˜¯å¦ä¸€æ ·</span></span><br><span class="line">    oldVnode.isComment === newVnode.isComment &amp;&amp; <span class="comment">// æ˜¯å¦éƒ½ä¸ºæ³¨é‡ŠèŠ‚ç‚¹</span></span><br><span class="line">    isDef(oldVnode.data) === isDef(newVnode.data) &amp;&amp; <span class="comment">// å±æ€§æ˜¯å¦éƒ½ç›¸åŒ</span></span><br><span class="line">    sameInputType(oldVnode, newVnode) <span class="comment">// å½“æ ‡ç­¾ä¸ºinputæ—¶ï¼Œtypeå¿…é¡»æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<h3 id="patchVnodeæ–¹æ³•"><a href="#patchVnodeæ–¹æ³•" class="headerlink" title="patchVnodeæ–¹æ³•"></a>patchVnodeæ–¹æ³•</h3><p>è¿™ä¸ªå‡½æ•°åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>æ‰¾åˆ°å¯¹åº”çš„<code>çœŸå®DOM</code>ï¼Œç§°ä¸º<code>el</code></li>
<li>åˆ¤æ–­<code>newVnode</code>å’Œ<code>oldVnode</code>æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆç›´æ¥<code>return</code></li>
<li>å¦‚æœä»–ä»¬éƒ½æœ‰æ–‡æœ¬èŠ‚ç‚¹å¹¶ä¸”ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå°†<code>el</code>çš„æ–‡æœ¬èŠ‚ç‚¹è®¾ç½®ä¸º<code>newVnode</code>çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚</li>
<li>å¦‚æœ<code>oldVnode</code>æœ‰å­èŠ‚ç‚¹è€Œ<code>newVnode</code>æ²¡æœ‰ï¼Œåˆ™åˆ é™¤<code>el</code>çš„å­èŠ‚ç‚¹</li>
<li>å¦‚æœ<code>oldVnode</code>æ²¡æœ‰å­èŠ‚ç‚¹è€Œ<code>newVnode</code>æœ‰ï¼Œåˆ™å°†<code>newVnode</code>çš„å­èŠ‚ç‚¹çœŸå®åŒ–ä¹‹åæ·»åŠ åˆ°<code>el</code></li>
<li>å¦‚æœä¸¤è€…éƒ½æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™æ‰§è¡Œ<code>updateChildren</code>å‡½æ•°æ¯”è¾ƒå­èŠ‚ç‚¹ï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchVnode</span>(<span class="params">oldVnode, newVnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> el = newVnode.el = oldVnode.el <span class="comment">// è·å–çœŸå®DOMå¯¹è±¡</span></span><br><span class="line">  <span class="comment">// è·å–æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°ç»„</span></span><br><span class="line">  <span class="keyword">const</span> oldCh = oldVnode.children, newCh = newVnode.children</span><br><span class="line">  <span class="comment">// å¦‚æœæ–°æ—§è™šæ‹ŸèŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ç»ˆæ­¢</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode === newVnode) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ–°æ—§è™šæ‹ŸèŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œä¸”æ–‡æœ¬ä¸ä¸€æ ·</span></span><br><span class="line">  <span class="keyword">if</span> (oldVnode.text !== <span class="literal">null</span> &amp;&amp; newVnode.text !== <span class="literal">null</span> &amp;&amp; oldVnode.text !== newVnode.text) &#123;</span><br><span class="line">    <span class="comment">// åˆ™ç›´æ¥å°†çœŸå®DOMä¸­æ–‡æœ¬æ›´æ–°ä¸ºæ–°è™šæ‹ŸèŠ‚ç‚¹çš„æ–‡æœ¬</span></span><br><span class="line">    api.setTextContent(el, newVnode.text)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦åˆ™</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldCh &amp;&amp; newCh &amp;&amp; oldCh !== newCh) &#123;</span><br><span class="line">      <span class="comment">// æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹éƒ½æœ‰å­èŠ‚ç‚¹ï¼Œä¸”å­èŠ‚ç‚¹ä¸ä¸€æ ·</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¯¹æ¯”å­èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°</span></span><br><span class="line">      updateChildren(el, oldCh, newCh)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newCh) &#123;</span><br><span class="line">      <span class="comment">// æ–°è™šæ‹ŸèŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œæ—§è™šæ‹ŸèŠ‚ç‚¹æ²¡æœ‰</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºæ–°è™šæ‹ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°åˆ°çœŸå®DOMä¸Šå»</span></span><br><span class="line">      createEle(newVnode)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldCh) &#123;</span><br><span class="line">      <span class="comment">// æ—§è™šæ‹ŸèŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œæ–°è™šæ‹ŸèŠ‚ç‚¹æ²¡æœ‰</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//ç›´æ¥åˆ é™¤çœŸå®DOMé‡Œå¯¹åº”çš„å­èŠ‚ç‚¹</span></span><br><span class="line">      api.removeChild(el)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>å…¶ä»–å‡ ä¸ªç‚¹éƒ½å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬è¯¦ç»†æ¥è®²ä¸€ä¸‹<code>updateChildren</code></p>
<h3 id="updateChildrenæ–¹æ³•"><a href="#updateChildrenæ–¹æ³•" class="headerlink" title="updateChildrenæ–¹æ³•"></a>updateChildrenæ–¹æ³•</h3><p>è¿™æ˜¯<code>patchVnode</code>é‡Œæœ€é‡è¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ–°æ—§è™šæ‹ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¯¹æ¯”ï¼Œå°±æ˜¯å‘ç”Ÿåœ¨<code>updateChildrenæ–¹æ³•</code>ä¸­ï¼Œæ¥ä¸‹æ¥å°±ç»“åˆä¸€äº›å›¾æ¥è®²ï¼Œè®©å¤§å®¶æ›´å¥½ç†è§£å§</p>
<p>æ˜¯æ€ä¹ˆæ ·ä¸€ä¸ªå¯¹æ¯”æ–¹æ³•å‘¢ï¼Ÿå°±æ˜¯<code>é¦–å°¾æŒ‡é’ˆæ³•</code>ï¼Œæ–°çš„å­èŠ‚ç‚¹é›†åˆå’Œæ—§çš„å­èŠ‚ç‚¹é›†åˆï¼Œå„æœ‰é¦–å°¾ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>a<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>b<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>c<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">ä¿®æ”¹æ•°æ®å</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>b<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>c<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>e<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>a<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæ–°æ—§ä¸¤ä¸ªå­èŠ‚ç‚¹é›†åˆä»¥åŠå…¶é¦–å°¾æŒ‡é’ˆä¸ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/3eb33b1b28e7461f9aedb857736a142c%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ2.55.26.png"></p>
<p>ç„¶åä¼šè¿›è¡Œäº’ç›¸è¿›è¡Œæ¯”è¾ƒï¼Œæ€»å…±æœ‰äº”ç§æ¯”è¾ƒæƒ…å†µï¼š</p>
<ul>
<li>1ã€<code>oldS å’Œ newS </code>ä½¿ç”¨<code>sameVnodeæ–¹æ³•</code>è¿›è¡Œæ¯”è¾ƒï¼Œ<code>sameVnode(oldS, newS)</code></li>
<li>2ã€<code>oldS å’Œ newE </code>ä½¿ç”¨<code>sameVnodeæ–¹æ³•</code>è¿›è¡Œæ¯”è¾ƒï¼Œ<code>sameVnode(oldS, newE)</code></li>
<li>3ã€<code>oldE å’Œ newS </code>ä½¿ç”¨<code>sameVnodeæ–¹æ³•</code>è¿›è¡Œæ¯”è¾ƒï¼Œ<code>sameVnode(oldE, newS)</code></li>
<li>4ã€<code>oldE å’Œ newE </code>ä½¿ç”¨<code>sameVnodeæ–¹æ³•</code>è¿›è¡Œæ¯”è¾ƒï¼Œ<code>sameVnode(oldE, newE)</code></li>
<li>5ã€å¦‚æœä»¥ä¸Šé€»è¾‘éƒ½åŒ¹é…ä¸åˆ°ï¼Œå†æŠŠæ‰€æœ‰æ—§å­èŠ‚ç‚¹çš„ <code>key</code> åšä¸€ä¸ªæ˜ å°„åˆ°æ—§èŠ‚ç‚¹ä¸‹æ ‡çš„ <code>key -&gt; index</code> è¡¨ï¼Œç„¶åç”¨æ–° <code>vnode</code> çš„ <code>key</code> å»æ‰¾å‡ºåœ¨æ—§èŠ‚ç‚¹ä¸­å¯ä»¥å¤ç”¨çš„ä½ç½®ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/727b5dd8a3424d22afd9dc5cf0dae05e%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ2.57.22.png"></p>
<p><strong>æ¥ä¸‹æ¥å°±ä»¥ä¸Šé¢ä»£ç ä¸ºä¾‹ï¼Œåˆ†æä¸€ä¸‹æ¯”è¾ƒçš„è¿‡ç¨‹</strong></p>
<p>åˆ†æä¹‹å‰ï¼Œè¯·å¤§å®¶è®°ä½ä¸€ç‚¹ï¼Œæœ€ç»ˆçš„æ¸²æŸ“ç»“æœéƒ½è¦ä»¥newVDOMä¸ºå‡†ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆä¹‹åçš„èŠ‚ç‚¹ç§»åŠ¨éœ€è¦ç§»åŠ¨åˆ°newVDOMæ‰€å¯¹åº”çš„ä½ç½®</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1efbc4e76c234dccb44cef0a75073d98%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ3.03.31.png"></p>
<ul>
<li>ç¬¬ä¸€æ­¥</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oldS = a, oldE = c</span><br><span class="line">newS = b, newE = a</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒç»“æœï¼š<code>oldS å’Œ newE</code> ç›¸ç­‰ï¼Œéœ€è¦æŠŠ<code>èŠ‚ç‚¹a</code>ç§»åŠ¨åˆ°<code>newE</code>æ‰€å¯¹åº”çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æœ«å°¾ï¼ŒåŒæ—¶<code>oldS++</code>ï¼Œ<code>newE--</code></p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/d7698f560bb44107911585580c241a99%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ3.26.25.png"></p>
<ul>
<li>ç¬¬äºŒæ­¥</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oldS = b, oldE = c</span><br><span class="line">newS = b, newE = e</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒç»“æœï¼š<code>oldS å’Œ newS</code>ç›¸ç­‰ï¼Œéœ€è¦æŠŠ<code>èŠ‚ç‚¹b</code>ç§»åŠ¨åˆ°<code>newS</code>æ‰€å¯¹åº”çš„ä½ç½®ï¼ŒåŒæ—¶<code>oldS++</code>,<code>newS++</code></p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1cda8545d6634bcdbf2d007193922092%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ3.27.13.png"></p>
<ul>
<li>ç¬¬ä¸‰æ­¥</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oldS = c, oldE = c</span><br><span class="line">newS = c, newE = e</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒç»“æœï¼š<code>oldSã€oldE å’Œ newS</code>ç›¸ç­‰ï¼Œéœ€è¦æŠŠ<code>èŠ‚ç‚¹c</code>ç§»åŠ¨åˆ°<code>newS</code>æ‰€å¯¹åº”çš„ä½ç½®ï¼ŒåŒæ—¶<code>oldS++</code>,<code>newS++</code></p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/fdbca1cefdec4ba08637c37a70f26af6%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ3.31.48.png"></p>
<ul>
<li>ç¬¬å››æ­¥</li>
</ul>
<p><code>oldS &gt; oldE</code>ï¼Œåˆ™<code>oldCh</code>å…ˆéå†å®Œæˆäº†ï¼Œè€Œ<code>newCh</code>è¿˜æ²¡éå†å®Œï¼Œè¯´æ˜<code>newChæ¯”oldChå¤š</code>ï¼Œæ‰€ä»¥éœ€è¦å°†å¤šå‡ºæ¥çš„èŠ‚ç‚¹ï¼Œæ’å…¥åˆ°çœŸå®DOMä¸Šå¯¹åº”çš„ä½ç½®ä¸Š</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/1ec374b664e94888b00721829738ea7a%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ3.37.51.png"></p>
<ul>
<li>æ€è€ƒé¢˜</li>
</ul>
<p>æˆ‘åœ¨è¿™é‡Œç»™å¤§å®¶ç•™ä¸€ä¸ªæ€è€ƒé¢˜å“ˆã€‚ä¸Šé¢çš„ä¾‹å­æ˜¯<code>newChæ¯”oldChå¤š</code>ï¼Œå‡å¦‚ç›¸åï¼Œæ˜¯<code>oldChæ¯”newChå¤š</code>çš„è¯ï¼Œé‚£å°±æ˜¯<code>newCh</code>å…ˆèµ°å®Œå¾ªç¯ï¼Œç„¶å<code>oldCh</code>ä¼šæœ‰å¤šå‡ºçš„èŠ‚ç‚¹ï¼Œç»“æœä¼šåœ¨çœŸå®DOMé‡Œè¿›è¡Œåˆ é™¤è¿™äº›æ—§èŠ‚ç‚¹ã€‚å¤§å®¶å¯ä»¥è‡ªå·±æ€è€ƒä¸€ä¸‹ï¼Œæ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œåƒæˆ‘ä¸€æ ·ï¼Œç”»å›¾æ¨¡æ‹Ÿï¼Œæ‰èƒ½å·©å›ºä¸Šé¢çš„çŸ¥è¯†ã€‚</p>
<p>é™„ä¸Š<code>updateChildren</code>çš„æ ¸å¿ƒåŸç†ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateChildren</span>(<span class="params">parentElm, oldCh, newCh</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span>, newStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> oldEndIdx = oldCh.length - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> oldEndVnode = oldCh[oldEndIdx]</span><br><span class="line">  <span class="keyword">let</span> newEndIdx = newCh.length - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> newStartVnode = newCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> newEndVnode = newCh[newEndIdx]</span><br><span class="line">  <span class="keyword">let</span> oldKeyToIdx</span><br><span class="line">  <span class="keyword">let</span> idxInOld</span><br><span class="line">  <span class="keyword">let</span> elmToMove</span><br><span class="line">  <span class="keyword">let</span> before</span><br><span class="line">  <span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="keyword">if</span> (oldStartVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldEndVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newEndVnode == <span class="literal">null</span>) &#123;</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      patchVnode(oldStartVnode, newStartVnode)</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      patchVnode(oldEndVnode, newEndVnode)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">      patchVnode(oldStartVnode, newEndVnode)</span><br><span class="line">      api.insertBefore(parentElm, oldStartVnode.el, api.nextSibling(oldEndVnode.el))</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">      patchVnode(oldEndVnode, newStartVnode)</span><br><span class="line">      api.insertBefore(parentElm, oldEndVnode.el, oldStartVnode.el)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ä½¿ç”¨keyæ—¶çš„æ¯”è¾ƒ</span></span><br><span class="line">      <span class="keyword">if</span> (oldKeyToIdx === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) <span class="comment">// æœ‰keyç”Ÿæˆindexè¡¨</span></span><br><span class="line">      &#125;</span><br><span class="line">      idxInOld = oldKeyToIdx[newStartVnode.key]</span><br><span class="line">      <span class="keyword">if</span> (!idxInOld) &#123;</span><br><span class="line">        api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)</span><br><span class="line">        newStartVnode = newCh[++newStartIdx]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        elmToMove = oldCh[idxInOld]</span><br><span class="line">        <span class="keyword">if</span> (elmToMove.sel !== newStartVnode.sel) &#123;</span><br><span class="line">          api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          patchVnode(elmToMove, newStartVnode)</span><br><span class="line">          oldCh[idxInOld] = <span class="literal">null</span></span><br><span class="line">          api.insertBefore(parentElm, elmToMove.el, oldStartVnode.el)</span><br><span class="line">        &#125;</span><br><span class="line">        newStartVnode = newCh[++newStartIdx]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    before = newCh[newEndIdx + <span class="number">1</span>] == <span class="literal">null</span> ? <span class="literal">null</span> : newCh[newEndIdx + <span class="number">1</span>].el</span><br><span class="line">    addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<h2 id="ç”¨indexåškey"><a href="#ç”¨indexåškey" class="headerlink" title="ç”¨indexåškey"></a>ç”¨indexåškey</h2><p>å¹³å¸¸v-forå¾ªç¯æ¸²æŸ“çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆä¸å»ºè®®ç”¨indexä½œä¸ºå¾ªç¯é¡¹çš„keyå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œå·¦è¾¹æ˜¯åˆå§‹æ•°æ®ï¼Œç„¶åæˆ‘åœ¨æ•°æ®å‰æ’å…¥ä¸€ä¸ªæ–°æ•°æ®ï¼Œå˜æˆå³è¾¹çš„åˆ—è¡¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;                      <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;0&quot;</span>&gt;</span>a<span class="tag">&lt;/<span class="name">li</span>&gt;</span>        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;0&quot;</span>&gt;</span>æ—ä¸‰å¿ƒ<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span>&gt;</span>b<span class="tag">&lt;/<span class="name">li</span>&gt;</span>        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span>&gt;</span>a<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>c<span class="tag">&lt;/<span class="name">li</span>&gt;</span>        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>b<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                              <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;3&quot;</span>&gt;</span>c<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span>                     &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>æŒ‰ç†è¯´ï¼Œæœ€ç†æƒ³çš„ç»“æœæ˜¯ï¼šåªæ’å…¥ä¸€ä¸ªliæ ‡ç­¾æ–°èŠ‚ç‚¹ï¼Œå…¶ä»–éƒ½ä¸åŠ¨ï¼Œç¡®ä¿æ“ä½œDOMæ•ˆç‡æœ€é«˜ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œç”¨äº†indexæ¥å½“keyçš„è¯ï¼ŒçœŸçš„ä¼šå®ç°æˆ‘ä»¬çš„ç†æƒ³ç»“æœå—ï¼ŸåºŸè¯ä¸å¤šè¯´ï¼Œå®è·µä¸€ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>å¢åŠ <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">list: [</span><br><span class="line">        &#123; <span class="attr">title</span>: <span class="string">&quot;a&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;100&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">title</span>: <span class="string">&quot;b&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;101&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">title</span>: <span class="string">&quot;c&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;102&quot;</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">      </span><br><span class="line"><span class="function"><span class="title">add</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.list.unshift(&#123; <span class="attr">title</span>: <span class="string">&quot;æ—ä¸‰å¿ƒ&quot;</span>, <span class="attr">id</span>: <span class="string">&quot;99&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>ç‚¹å‡»æŒ‰é’®æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬é¢„æƒ³çš„ç»“æœï¼Œè€Œæ˜¯æ‰€æœ‰liæ ‡ç­¾éƒ½æ›´æ–°äº†</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/44fc88e0125f49328afb321108c72bcd%7Etplv-k3u1fbpfcp-watermark.awebp" alt="keyindex.gif"></p>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿè¿˜æ˜¯é€šè¿‡å›¾æ¥è§£é‡Š</p>
<p>æŒ‰ç†è¯´ï¼Œ<code>aï¼Œbï¼Œc</code>ä¸‰ä¸ªliæ ‡ç­¾éƒ½æ˜¯å¤ç”¨ä¹‹å‰çš„ï¼Œå› ä¸ºä»–ä»¬ä¸‰ä¸ªæ ¹æœ¬æ²¡æ”¹å˜ï¼Œæ”¹å˜çš„åªæ˜¯å‰é¢æ–°å¢äº†ä¸€ä¸ª<code>æ—ä¸‰å¿ƒ</code></p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/f4f0d74d014743a79e11552b0c9351d5%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ5.43.25.png"></p>
<p>ä½†æ˜¯æˆ‘ä»¬å‰é¢è¯´äº†ï¼Œåœ¨è¿›è¡Œå­èŠ‚ç‚¹çš„ <code>diffç®—æ³•</code> è¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œ æ—§é¦–èŠ‚ç‚¹å’Œæ–°é¦–èŠ‚ç‚¹çš„<code>sameNode</code>å¯¹æ¯”ï¼Œè¿™ä¸€æ­¥å‘½ä¸­äº†é€»è¾‘ï¼Œå› ä¸ºç°åœ¨<code>æ–°æ—§ä¸¤æ¬¡é¦–éƒ¨èŠ‚ç‚¹</code> çš„ <code>key</code> éƒ½æ˜¯ <code>0</code>äº†ï¼ŒåŒç†ï¼Œkeyä¸º1å’Œ2çš„ä¹Ÿæ˜¯å‘½ä¸­äº†é€»è¾‘ï¼Œå¯¼è‡´<code>ç›¸åŒkeyçš„èŠ‚ç‚¹</code>ä¼šå»è¿›è¡Œ<code>patchVnode</code>æ›´æ–°æ–‡æœ¬ï¼Œè€ŒåŸæœ¬å°±æœ‰çš„<code>cèŠ‚ç‚¹</code>ï¼Œå´å› ä¸ºä¹‹å‰æ²¡æœ‰keyä¸º4çš„èŠ‚ç‚¹ï¼Œè€Œè¢«å½“åšäº†æ–°èŠ‚ç‚¹ï¼Œæ‰€ä»¥å¾ˆæç¬‘ï¼Œä½¿ç”¨indexåškeyï¼Œæœ€åæ–°å¢çš„å±…ç„¶æ˜¯æœ¬æ¥å°±å·²æœ‰çš„cèŠ‚ç‚¹ã€‚æ‰€ä»¥å‰ä¸‰ä¸ªéƒ½è¿›è¡Œ<code>patchVnode</code>æ›´æ–°æ–‡æœ¬ï¼Œæœ€åä¸€ä¸ªè¿›è¡Œäº†<code>æ–°å¢</code>ï¼Œé‚£å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæ‰€æœ‰liæ ‡ç­¾éƒ½æ›´æ–°äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/ecc93fb2bc544a83b8cc7b7cbcaf1857%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ5.45.17.png"></p>
<p>é‚£æˆ‘ä»¬å¯ä»¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬åªè¦ä½¿ç”¨ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼æ¥å½“åškeyå°±è¡Œäº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å†æ¥çœ‹çœ‹æ•ˆæœ</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/885269d6d23340f19e9100ec60564173%7Etplv-k3u1fbpfcp-watermark.awebp" alt="idkey.gif"></p>
<p>ä¸ºä»€ä¹ˆç”¨äº†idæ¥å½“åškeyå°±å®ç°äº†æˆ‘ä»¬çš„ç†æƒ³æ•ˆæœå‘¢ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯ï¼Œ<code>aï¼Œbï¼ŒcèŠ‚ç‚¹</code>çš„<code>key</code>å°±ä¼šæ˜¯æ°¸è¿œä¸å˜çš„ï¼Œæ›´æ–°å‰åkeyéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”åˆç”±äº<code>aï¼Œbï¼ŒcèŠ‚ç‚¹</code>çš„å†…å®¹æœ¬æ¥å°±æ²¡å˜ï¼Œæ‰€ä»¥å°±ç®—æ˜¯è¿›è¡Œäº†<code>patchVnode</code>ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œé‡Œé¢å¤æ‚çš„æ›´æ–°æ“ä½œï¼ŒèŠ‚çœäº†æ€§èƒ½ï¼Œè€Œæ—ä¸‰å¿ƒèŠ‚ç‚¹ï¼Œç”±äºæ›´æ–°å‰æ²¡æœ‰ä»–çš„keyæ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»–è¢«å½“åšæ–°çš„èŠ‚ç‚¹ï¼Œå¢åŠ åˆ°çœŸå®DOMä¸Šå»äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/Yummy-zZ/FigureBed/main/img/833e0a795a3e4893a0c03bb78a63bffc%7Etplv-k3u1fbpfcp-watermark.awebp" alt="æˆªå±2021-08-08 ä¸‹åˆ6.04.34.png"></p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å¸Œæœ›èƒ½å¸®åˆ°é‚£äº›ä¸€ç›´æƒ³äº†è§£è™šæ‹ŸDOMå’ŒDiffç®—æ³•çš„åŒå­¦</p>
<p>å¦‚æœä½ è§‰å¾—æœ¬æ–‡æœ‰å¸®åˆ°ä½ ä¸€ç‚¹ç‚¹çš„è¯ï¼Œè¯·ç‚¹ä¸ªèµå‘—å“ˆå“ˆ</p>
<p>æ¬¢è¿å„ä½åŒå­¦æŒ‡å‡ºæˆ‘çš„é”™è¯¯ï¼Œæˆ‘ä¼šåŠæ—¶æ›´æ”¹æ»´</p>
<p>å­¦ä¹ ç¾¤è¯·ç‚¹<a target="_blank" rel="noopener" href="https://juejin.cn/pin/6969565162885873701">è¿™é‡Œ</a>ï¼Œä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·æ‘¸é±¼ï¼ï¼ï¼</p>
<p>é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6994959998283907102">https://juejin.cn/post/6994959998283907102</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%AF%8F%E6%97%A5%E6%80%BB%E7%BB%93/" rel="tag"># æ¯æ—¥æ€»ç»“</a>
              <a href="/tags/diff%E7%AE%97%E6%B3%95/" rel="tag"># diffç®—æ³•</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/09/17/18-Vue%E8%B7%AF%E7%94%B1%E5%AE%88%E5%8D%AB/" rel="prev" title="18-Vueè·¯ç”±å®ˆå«">
      <i class="fa fa-chevron-left"></i> 18-Vueè·¯ç”±å®ˆå«
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/18/20-%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/" rel="next" title="20-å“åº”å¼åŸç†">
      20-å“åº”å¼åŸç† <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8C%B9%E8%99%9A%E6%8B%9FDOM"><span class="nav-number">1.</span> <span class="nav-text">ğŸŒ¹è™šæ‹ŸDOM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8C%88%E4%BB%80%E4%B9%88%E6%98%AFdiff%E7%AE%97%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">ğŸŒˆä»€ä¹ˆæ˜¯diffç®—æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8D%93Diff%E7%AE%97%E6%B3%95%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">ğŸ“Diffç®—æ³•çš„åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%91%A0%E5%90%8C%E5%B1%82%E6%AF%94%E8%BE%83"><span class="nav-number">3.1.</span> <span class="nav-text">â‘ åŒå±‚æ¯”è¾ƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%91%A1%E5%AF%B9%E6%AF%94%E6%B5%81%E7%A8%8B"><span class="nav-number">3.2.</span> <span class="nav-text">â‘¡å¯¹æ¯”æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch%E6%96%B9%E6%B3%95"><span class="nav-number">3.3.</span> <span class="nav-text">patchæ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sameVnode%E6%96%B9%E6%B3%95"><span class="nav-number">3.4.</span> <span class="nav-text">sameVnodeæ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patchVnode%E6%96%B9%E6%B3%95"><span class="nav-number">3.5.</span> <span class="nav-text">patchVnodeæ–¹æ³•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#updateChildren%E6%96%B9%E6%B3%95"><span class="nav-number">3.6.</span> <span class="nav-text">updateChildrenæ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8index%E5%81%9Akey"><span class="nav-number">4.</span> <span class="nav-text">ç”¨indexåškey</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">5.</span> <span class="nav-text">ç»“è¯­</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Eden Yi"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">Eden Yi</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Yummy-zZ" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Yummy-zZ" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yjh2412750872@gmail.com" title="E-Mail â†’ mailto:yjh2412750872@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eden Yi</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div><script color="66,197,172" opacity="0.85" zIndex="-1" count="88" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>
